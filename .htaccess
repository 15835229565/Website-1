RewriteEngine on
RewriteBase /

# Some redirects
Redirect /fb http://www.facebook.com/daaniel
Redirect /ms http://www.myspace.com/daniel_1515
# Shortened URLs
Redirect /ldr http://dan.cx/blog/2009/12/the-story-of-a-long-distance-relationship/

# Protect hidden files from being viewed
<Files .*>
	Order Deny,Allow
	Deny From All
</Files>

# Protect application and system files from being viewed
RewriteRule ^(?:application|modules|system)\b.* index.php/$0 [L]

# Make sure we're using the correct domain
RewriteCond %{HTTP_HOST}   !^dan\.cx [NC]
RewriteCond %{HTTP_HOST}   !^dev\.dan\.cx [NC]
RewriteCond %{HTTP_HOST}   !^ss\.dan\.cx [NC]
RewriteCond %{HTTP_HOST}   !^localhost [NC]
RewriteCond %{HTTP_HOST}   !^staging\.dan\.cx [NC]
RewriteCond %{HTTP_HOST}   !^thoughts\.dan\.cx [NC]
RewriteCond %{HTTP_HOST}   !^$
# This can't be redirected.
RewriteCond %{REQUEST_FILENAME} !google61623b5951d83a31.html
RewriteRule ^(.*)         http://dan.cx/$1 [L,R=permanent]

# Redirect pages from old WordPress blog
RewriteRule ^blog/page/([0-9]+)/$ blog?page=$1 [L,R=permanent]
# Redirect old URLs with days as well as month and year
RewriteRule ^blog/(\d{4})/(\d{2})/(\d{2})/(.+)/$ blog/$1/$2/$4 [L,R=permanent]
# Redirect old trackback URLs
RewriteRule ^blog/(\d{4})/(\d{2})/(.+)/trackback/$ blog/$1/$2/$3 [L,R=permanent]

# Redirect old WordPress blog URLs (categories, posts) to new ones (no trailing slash)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} blog/(.*)/$
RewriteRule ^blog/(.*)/$ blog/$1 [L,R=permanent] 

# Rewrite old WordPress images
RewriteRule ^blog/wp-content/uploads/(.+)$ oldblog/wp-content/uploads/$1 [L]

# Allow any files or directories that exist to be displayed directly
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
# Rewrite all other URLs to index.php/URL
RewriteRule .* index.php/$0 [PT]
